<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">

        <p:growl id="idGrowl" />

        <h:form id="frmInventario">

            <p:outputPanel style="text-align: center">
                <p:panelGrid columns="2">
                    <p:outputLabel for="IDSUC" value="Sucursal"/>
                    <p:selectOneMenu id="IDSUC"
                                     required="true"
                                     requiredMessage="Selecione sucursal"
                                     value="#{inventarioC.inventario.IDSUC}">
                        <f:selectItem  itemValue="#{null}" itemLabel="Selecione equipo" />
                        <f:selectItems var="sucursal" 
                                       value="#{sucursalC.listaSucursal}"
                                       itemValue="#{sucursal.IDSUC}" 
                                       itemLabel="#{sucursal.NOMSUC}"/>
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="IDEQUI" value="Equipo"/>
                    <p:selectOneMenu id="IDEQUI"
                                     required="true"
                                     requiredMessage="Selecione equipo"
                                     value="#{inventarioC.inventario.IDEQUI}">
                        <f:selectItem  itemValue="#{null}" itemLabel="Selecione equipo" />
                        <f:selectItems var="equipo" 
                                       value="#{equipoC.listaEquipo}"
                                       itemValue="#{equipo.IDEQUI}" 
                                       itemLabel="#{equipo.DESEQUI}"/>
                    </p:selectOneMenu>

                    <p:outputLabel for="CANTINV" value="Cantidad"/>
                    <p:spinner id="CANTINV" 
                               required="true"
                               requiredMessage="Cantidad obligatoria"
                               value="#{inventarioC.inventario.CANTINV}"/>
                </p:panelGrid>
            </p:outputPanel>
            <p:commandButton actionListener="#{inventarioC.registrar()}" 
                             value="Registrar"
                             update=":idGrowl @form :idTblInventario:tblInventario"/>
        </h:form>


        <h:form id="idTblInventario">
            <p:dataTable id="tblInventario" 
                         value="#{inventarioC.listaInventario}"
                         var="lista">
                
                <p:column headerText="Sucursal">
                    <h:outputText value="#{lista.NOMSUC}" />
                </p:column>

                <p:column headerText="Equipos">
                    <h:outputText value="#{lista.DESEQUI}" />
                </p:column>

                <p:column headerText="Cantidad">
                    <h:outputText value="#{lista.CANTINV}" />
                </p:column>
                
                <p:column headerText="Cantidad">
                    <p:commandButton value="Ver"
                                     update=":frmdInventario :frmdInventario:tblInventario" 
                                     oncomplete="PF('dlqwInventario').show()"
                                     actionListener="#{inventarioC.listarHistorial(lista.IDSUC, lista.IDEQUI)}"/>
                </p:column>
                
            </p:dataTable>
        </h:form>


        <p:dialog id="dlgInventario" 
                  modal="true"
                  closable="false"
                  widgetVar="dlqwInventario">
            <h:form id="frmdInventario">

                <p:dataTable id="tblInventario" 
                             value="#{inventarioC.listaInventarioHistorial}"
                             var="lista">
                    
                    <p:column headerText="FECINV">
                        <h:outputText value="#{lista.FECINV}" />
                    </p:column>
                    
                    <p:column headerText="DESEQUI">
                        <h:outputText value="#{lista.DESEQUI}" />
                    </p:column>

                    <p:column headerText="Cantidad">
                        <h:outputText value="#{lista.CANTINV}" />
                    </p:column>
                    
                    <p:column headerText="TIPINV">
                        <h:outputText value="#{lista.TIPINV}">
                            <f:converter converterId="ConverterTipoInventario" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>

                <p:commandButton value="Cerrar"
                                 oncomplete="PF('dlqwInventario').hide()"
                                 update=":idGrowl frmdInventario :idTblInventario:tblInventario"/>
            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>
