<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">
        <p:growl id="idGrowl" /> 

        <h:form id="frmPersona">
            <p:outputPanel style="text-align: center">
                <p:panelGrid columns="2">
                    <p:outputLabel for="NOMPER" value="Nombre"/>
                    <p:inputText id="NOMPER" 
                                 required="true"
                                 requiredMessage="Nombre obligatorio"
                                 value="#{personaC.persona.NOMPER}"/>


                    <p:outputLabel for="APEPER" value="Apellido"/>
                    <p:inputText id="APEPER" 
                                 required="true"
                                 requiredMessage="Apellido obligatorio"
                                 value="#{personaC.persona.APEPER}"/>

                    <p:outputLabel for="DNIPER" value="DNI"/>
                    <p:inputText id="DNIPER"
                                 maxlength="8"
                                 required="true"
                                 requiredMessage="DNI obligatorio"
                                 value="#{personaC.persona.DNIPER}">
                        <f:validateLength minimum="8" />
                    </p:inputText>

                    <p:outputLabel for="TIPPER" value="TIPO"/>
                    <p:selectOneRadio value="#{personaC.persona.TIPPER}"
                                      id="TIPPER" 
                                      required="true"
                                      requiredMessage="Tipo obligatorio">
                        <f:selectItem itemLabel="Admin" itemValue="A"/>
                        <f:selectItem itemLabel="Jefe" itemValue="J"/>
                        <f:selectItem itemLabel="Ven." itemValue="V"/>
                    </p:selectOneRadio>

                    <p:outputLabel for="PSWPER" value="Contrase単a"/>
                    <p:password id="PSWPER" 
                                required="true"
                                requiredMessage="Contrase単a obligatorio"
                                value="#{personaC.persona.PSWPER}"/>



                    <p:commandButton actionListener="#{personaC.registrar()}" 
                                     value="Registrar"
                                     update=":idGrowl @form :idTblPersona:tblPersona"/>
                </p:panelGrid>
            </p:outputPanel>
        </h:form>

        <h:form id="idTblPersona">

            <p:dataTable id="tblPersona" 
                         value="#{personaC.listaPersona}"
                         var="lista" 
                         rowKey="#{lista.IDPER}"
                         selection="#{personaC.selectPersona}" 
                         selectionMode="single">
                <p:column headerText="ID" >
                    <h:outputText value="#{lista.IDPER}"/>
                </p:column>

                <p:column headerText="Nombre">
                    <h:outputText value="#{lista.NOMPER}"/>
                </p:column>

                <p:column headerText="Apellido">
                    <h:outputText value="#{lista.APEPER}"/>
                </p:column>

                <p:column headerText="DNI">
                    <h:outputText value="#{lista.DNIPER}"/>
                </p:column>

                <p:column headerText="Tipo">
                    <h:outputText value="#{lista.TIPPER}">
                        <f:converter converterId="ConverterTipoPersona"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Estado">
                    <h:outputText value="#{lista.ESTAPER}"/>
                </p:column>
            </p:dataTable>

            <p:contextMenu for="tblPersona">
                <p:menuitem value="Modificar" update=":frmdPersona" oncomplete="PF('dlqwPersona').show()"/>
                <p:menuitem value="Eliminar" update="idTblPersona :idGrowl" actionListener="#{personaC.eliminar()}"/>
            </p:contextMenu>

        </h:form>


        <p:dialog id="dlgPersona" widgetVar="dlqwPersona">
            <h:form id="frmdPersona">
                <p:outputPanel style="text-align: center" >
                    <p:panelGrid columns="2">
                        <p:outputLabel for="NOMPER" value="Nombre"/>
                        <p:inputText id="NOMPER" 
                                     required="true"
                                     requiredMessage="Nombre obligatorio"
                                     value="#{personaC.selectPersona.NOMPER}"/>


                        <p:outputLabel for="APEPER" value="Apellido"/>
                        <p:inputText id="APEPER" 
                                     required="true"
                                     requiredMessage="Apellido obligatorio"
                                     value="#{personaC.selectPersona.APEPER}"/>

                        <p:outputLabel for="DNIPER" value="DNI"/>
                        <p:inputText id="DNIPER" 
                                     required="true"
                                     requiredMessage="DNI obligatorio"
                                     value="#{personaC.selectPersona.DNIPER}"/>

                        <p:outputLabel for="TIPPER" value="Tipo"/>
                        <p:selectOneRadio value="#{personaC.selectPersona.TIPPER}"
                                          id="TIPPER" 
                                          required="true"
                                          requiredMessage="Tipo obligatorio">
                            <f:selectItem itemLabel="Admin" itemValue="A"/>
                            <f:selectItem itemLabel="Jefe." itemValue="J"/>
                            <f:selectItem itemLabel="Vend." itemValue="V"/>
                        </p:selectOneRadio>
                    </p:panelGrid>
                    <p:commandButton actionListener="#{personaC.modificar()}" 
                                     value="Modificar"
                                     oncomplete="if(args &amp;&amp; !args.validationFailed)PF('dlqwPersona').hide()"
                                     update=":idGrowl frmdPersona :idTblPersona:tblPersona"/>
                    <p:commandButton value="Modificar Credencial" 
                                     update=":frmdPersona" 
                                     oncomplete="PF('dlqwPersona1').show()">
                    </p:commandButton>
                    <p:commandButton value="Cerrar"
                                     process="@this"
                                     oncomplete="PF('dlqwPersona').hide()"
                                     update=":idGrowl frmdPersona :idTblPersona:tblPersona">
                        <p:resetInput target="dlgwPersona" />
                    </p:commandButton>
                </p:outputPanel>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgPersona1" widgetVar="dlqwPersona1">
            <h:form id="frmdPersona1">
                <p:outputPanel style="text-align: center" >
                    <p:panelGrid columns="2">
                        <p:outputLabel for="PSWPER" value="Contrase単a"/>
                        <p:password id="PSWPER" 
                                    required="true"
                                    requiredMessage="Contrase単a obligatorio"
                                    value="#{personaC.selectPersona.PSWPER}"/>
                    </p:panelGrid>
                    <p:commandButton actionListener="#{personaC.modificarCredencial()}" 
                                     value="Modificar"
                                     oncomplete="if(args &amp;&amp; !args.validationFailed)PF('dlqwPersona1').hide()"
                                     update=":idGrowl frmdPersona1 :idTblPersona:tblPersona"/>

                    <p:commandButton value="Cerrar"
                                     process="@this"
                                     oncomplete="PF('dlqwPersona1').hide()"
                                     update=":idGrowl frmdPersona1 :idTblPersona:tblPersona">
                        <p:resetInput target="dlgwPersona1" />
                    </p:commandButton>
                </p:outputPanel>
            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>
